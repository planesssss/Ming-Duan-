#include <iostream>
#include <vector>
#include <string>
#include <iomanip>
#include <limits>

using namespace std;

// 学生结构体
struct Student {
    int id;           // 学号
    string name;      // 姓名
    double score;     // 成绩
    
    Student(int _id, string _name, double _score) 
        : id(_id), name(_name), score(_score) {}
};

// 班级类
class Class {
private:
    vector<Student> students;
    int nextId;  // 下一个可用的学号
    
public:
    Class() : nextId(1) {}
    
    // 添加学生
    void addStudent() {
        string name;
        double score;
        
        cout << "\n=== 添加学生 ===" << endl;
        cout << "请输入学生姓名: ";
        cin.ignore();  // 清除输入缓冲区
        getline(cin, name);
        
        cout << "请输入学生成绩: ";
        while (!(cin >> score) || score < 0 || score > 100) {
            cout << "成绩无效，请输入0-100之间的数字: ";
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
        }
        
        students.push_back(Student(nextId, name, score));
        cout << "学生添加成功! 学号: " << nextId << endl;
        nextId++;
    }
    
    // 显示所有学生
    void showAllStudents() {
        if (students.empty()) {
            cout << "\n没有学生信息!" << endl;
            return;
        }
        
        cout << "\n=== 所有学生信息 ===" << endl;
        cout << "==================================" << endl;
        cout << left << setw(10) << "学号" 
             << setw(15) << "姓名" 
             << setw(10) << "成绩" << endl;
        cout << "==================================" << endl;
        
        for (const auto& student : students) {
            cout << left << setw(10) << student.id
                 << setw(15) << student.name
                 << setw(10) << fixed << setprecision(1) << student.score << endl;
        }
        cout << "==================================" << endl;
    }
    
    // 查找学生
    void findStudent() {
        if (students.empty()) {
            cout << "\n没有学生信息!" << endl;
            return;
        }
        
        int choice;
        cout << "\n=== 查找学生 ===" << endl;
        cout << "1. 按学号查找" << endl;
        cout << "2. 按姓名查找" << endl;
        cout << "请选择查找方式: ";
        cin >> choice;
        
        if (choice == 1) {
            int id;
            cout << "请输入学号: ";
            cin >> id;
            
            bool found = false;
            for (const auto& student : students) {
                if (student.id == id) {
                    displayStudent(student);
                    found = true;
                    break;
                }
            }
            
            if (!found) {
                cout << "未找到学号为 " << id << " 的学生!" << endl;
            }
        } 
        else if (choice == 2) {
            string name;
            cout << "请输入姓名: ";
            cin.ignore();
            getline(cin, name);
            
            bool found = false;
            for (const auto& student : students) {
                if (student.name == name) {
                    displayStudent(student);
                    found = true;
                }
            }
            
            if (!found) {
                cout << "未找到姓名为 " << name << " 的学生!" << endl;
            }
        } 
        else {
            cout << "无效的选择!" << endl;
        }
    }
    
    // 删除学生
    void deleteStudent() {
        if (students.empty()) {
            cout << "\n没有学生信息!" << endl;
            return;
        }
        
        int id;
        cout << "\n=== 删除学生 ===" << endl;
        cout << "请输入要删除学生的学号: ";
        cin >> id;
        
        for (auto it = students.begin(); it != students.end(); ++it) {
            if (it->id == id) {
                cout << "找到学生: " << it->name << "，成绩: " << it->score << endl;
                cout << "确定要删除吗? (1=是, 0=否): ";
                int confirm;
                cin >> confirm;
                
                if (confirm == 1) {
                    students.erase(it);
                    cout << "学生删除成功!" << endl;
                } else {
                    cout << "取消删除操作!" << endl;
                }
                return;
            }
        }
        
        cout << "未找到学号为 " << id << " 的学生!" << endl;
    }
    
    // 修改学生信息
    void updateStudent() {
        if (students.empty()) {
            cout << "\n没有学生信息!" << endl;
            return;
        }
        
        int id;
        cout << "\n=== 修改学生信息 ===" << endl;
        cout << "请输入要修改学生的学号: ";
        cin >> id;
        
        for (auto& student : students) {
            if (student.id == id) {
                displayStudent(student);
                
                int choice;
                cout << "\n请选择要修改的内容:" << endl;
                cout << "1. 修改姓名" << endl;
                cout << "2. 修改成绩" << endl;
                cout << "3. 修改所有信息" << endl;
                cout << "请输入选择: ";
                cin >> choice;
                
                if (choice == 1 || choice == 3) {
                    cout << "请输入新的姓名: ";
                    cin.ignore();
                    getline(cin, student.name);
                }
                
                if (choice == 2 || choice == 3) {
                    cout << "请输入新的成绩: ";
                    while (!(cin >> student.score) || student.score < 0 || student.score > 100) {
                        cout << "成绩无效，请输入0-100之间的数字: ";
                        cin.clear();
                        cin.ignore(numeric_limits<streamsize>::max(), '\n');
                    }
                }
                
                cout << "学生信息修改成功!" << endl;
                displayStudent(student);
                return;
            }
        }
        
        cout << "未找到学号为 " << id << " 的学生!" << endl;
    }
    
    // 显示统计信息
    void showStatistics() {
        if (students.empty()) {
            cout << "\n没有学生信息!" << endl;
            return;
        }
        
        double total = 0;
        double maxScore = students[0].score;
        double minScore = students[0].score;
        
        for (const auto& student : students) {
            total += student.score;
            if (student.score > maxScore) maxScore = student.score;
            if (student.score < minScore) minScore = student.score;
        }
        
        double average = total / students.size();
        
        cout << "\n=== 成绩统计 ===" << endl;
        cout << "学生总数: " << students.size() << endl;
        cout << "平均成绩: " << fixed << setprecision(2) << average << endl;
        cout << "最高成绩: " << maxScore << endl;
        cout << "最低成绩: " << minScore << endl;
        
        // 成绩分布
        int excellent = 0, good = 0, medium = 0, pass = 0, fail = 0;
        for (const auto& student : students) {
            if (student.score >= 90) excellent++;
            else if (student.score >= 80) good++;
            else if (student.score >= 70) medium++;
            else if (student.score >= 60) pass++;
            else fail++;
        }
        
        cout << "\n=== 成绩分布 ===" << endl;
        cout << "优秀(90-100): " << excellent << " 人" << endl;
        cout << "良好(80-89): " << good << " 人" << endl;
        cout << "中等(70-79): " << medium << " 人" << endl;
        cout << "及格(60-69): " << pass << " 人" << endl;
        cout << "不及格(0-59): " << fail << " 人" << endl;
    }
    
private:
    // 显示单个学生信息
    void displayStudent(const Student& student) {
        cout << "\n=== 学生信息 ===" << endl;
        cout << "学号: " << student.id << endl;
        cout << "姓名: " << student.name << endl;
        cout << "成绩: " << fixed << setprecision(1) << student.score << endl;
    }
};

// 显示菜单
void showMenu() {
    cout << "\n========= 学生成绩管理系统 =========" << endl;
    cout << "1. 添加学生" << endl;
    cout << "2. 显示所有学生" << endl;
    cout << "3. 查找学生" << endl;
    cout << "4. 修改学生信息" << endl;
    cout << "5. 删除学生" << endl;
    cout << "6. 成绩统计" << endl;
    cout << "7. 退出系统" << endl;
    cout << "===================================" << endl;
    cout << "请选择操作 (1-7): ";
}

int main() {
    Class myClass;
    int choice;
    
    // 添加一些示例数据
    myClass.addStudent("张三", 85.5);
    myClass.addStudent("李四", 92.0);
    myClass.addStudent("王五", 76.5);
    
    cout << "欢迎使用学生成绩管理系统!" << endl;
    
    do {
        showMenu();
        cin >> choice;
        
        switch (choice) {
            case 1:
                myClass.addStudent();
                break;
            case 2:
                myClass.showAllStudents();
                break;
            case 3:
                myClass.findStudent();
                break;
            case 4:
                myClass.updateStudent();
                break;
            case 5:
                myClass.deleteStudent();
                break;
            case 6:
                myClass.showStatistics();
                break;
            case 7:
                cout << "感谢使用学生成绩管理系统，再见!" << endl;
                break;
            default:
                cout << "无效的选择，请重新输入!" << endl;
                break;
        }
        
    } while (choice != 7);
    
    return 0;
}
